rule RANSOM_7ev3n {
    meta:
        author = "KrknSec"
        description = "Detects 7ev3n ransomware."
        date = "2022-09-29"
        reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.7ev3n"
    strings:
        $s1 = { 43 3a 5c 5c 55 73 65 72 73 5c 5c 61 64 6d 69 6e 5c 5c 44 65 73 6b 74 6f 70 5c 5c 6e 65 77 20 76 65 72 73 69 6f 6e 20 77 69 74 68 20 4e 4f 20 55 41 43 5c 5c 52 65 6c 65 61 73 65 5c 5c 57 69 6e 33 32 50 72 6f 6a 65 63 74 39 2e 70 64 62 }
        $s2 = { 74 61 73 6b 6b 69 6c 6c 20 2f 49 4d 20 63 6f 6e 6c 68 6f 73 74 2e 65 78 65 }
        $s3 = { 34 2e 20 43 6f 6e 66 69 72 6d 61 74 69 6f 6e 20 6f 66 20 6f 6e 65 20 74 72 61 6e 73 61 63 74 69 6f 6e 20 74 61 6b 65 73 20 33 30 20 6d 69 6e 75 74 65 73 20 6f 72 20 6c 65 73 73 2e 54 68 65 20 70 72 6f 63 65 73 73 20 6f 66 20 66 69 6c 65 73 20 64 65 63 72 79 70 74 69 6f 6e 20 61 6e 64 20 73 65 6c 66 20 2d 20 64 65 6c 65 74 69 6e 67 20 69 73 20 61 75 74 6f 6d 61 74 65 64 2e }
        $s4 = { 44 65 63 72 79 70 74 69 6f 6e 20 70 72 6f 63 65 73 73 20 74 61 6b 65 73 20 31 20 2d 20 33 20 68 6f 75 72 73 20 62 61 73 65 64 20 6f 6e 20 74 68 65 20 61 6d 6f 75 6e 74 20 6f 66 20 65 6e 63 72 79 70 74 65 64 20 66 69 6c 65 73 2c 20 64 65 63 72 79 70 74 69 6f 6e 20 73 70 65 65 64 20 69 73 20 37 20 47 62 20 2f 20 68 72 2e }
        $s5 = { 46 69 6c 65 20 64 65 63 72 79 70 74 69 6f 6e 20 70 72 6f 63 65 73 73 20 69 73 20 63 6f 6d 70 6c 65 74 65 6c 79 20 61 75 74 6f 6d 61 74 65 64 21 20 54 68 65 20 70 72 6f 63 65 73 73 20 69 73 20 5c 22 50 41 59 20 2d 20 44 45 43 52 59 50 54 5c 22 2e }
        $s6 = { 63 6f 6e 6c 68 6f 73 74 2e 65 78 65 }
        $s7 = { 52 45 47 20 41 44 44 20 5c 22 48 4b 45 59 5f 43 55 52 52 45 4e 54 5f 55 53 45 52 5c 5c 53 4f 46 54 57 41 52 45 5c 5c 4d 69 63 72 6f 73 6f 66 74 5c 5c 57 69 6e 64 6f 77 73 5c 5c 43 75 72 72 65 6e 74 56 65 72 73 69 6f 6e 5c 5c 52 75 6e 5c 22 20 2f 76 20 5c 22 61 6c 6c 6b 65 65 70 65 72 5c 22 20 2f 74 20 52 45 47 5f 53 5a 20 2f 64 20 5c 22 }
        $s8 = { 52 45 47 20 44 45 4c 45 54 45 20 5c 22 48 4b 45 59 5f 43 55 52 52 45 4e 54 5f 55 53 45 52 5c 5c 53 4f 46 54 57 41 52 45 5c 5c 4d 69 63 72 6f 73 6f 66 74 5c 5c 57 69 6e 64 6f 77 73 5c 5c 43 75 72 72 65 6e 74 56 65 72 73 69 6f 6e 5c 5c 52 75 6e 5c 22 20 2f 76 20 5c 22 61 6c 6c 6b 65 65 70 65 72 5c 22 20 2f 66 }
        $s9 = { 35 2e 20 54 6f 20 67 65 74 20 6b 65 79 73 20 61 6e 64 20 73 74 61 72 74 20 64 65 63 72 79 70 74 69 6e 67 20 70 72 6f 63 65 73 73 20 61 66 74 65 72 20 70 61 79 6d 65 6e 74 2c 20 70 6c 65 61 73 65 20 65 6e 73 75 72 65 20 74 68 61 74 20 79 6f 75 72 20 69 6e 74 65 72 6e 65 74 2d 63 6f 6e 6e 65 63 74 69 6f 6e 20 69 73 20 61 63 74 69 76 65 21 }
        $s10 = { 68 74 74 70 73 3a 2f 2f 65 78 63 68 61 6e 67 65 2e 6d 6f 6e 65 74 61 67 6f 2e 63 6f 6d }
        $s11 = { 2d 20 54 6f 20 62 75 79 20 62 69 74 63 6f 69 6e 73 20 69 6e 20 74 68 65 20 6e 65 61 72 65 73 74 20 62 69 74 63 6f 69 6e 20 41 54 4d 3b 20 72 65 66 65 72 20 74 6f 20 74 68 65 20 61 64 64 72 65 73 73 20 6f 6e 20 61 20 77 65 62 73 69 74 65 3a 20 63 6f 69 6e 61 74 6d 72 61 64 61 72 2e 63 6f 6d 2f 63 6f 75 6e 74 72 69 65 73 2f }
        $s12 = { 52 45 47 20 41 44 44 20 5c 22 48 4b 45 59 5f 43 55 52 52 45 4e 54 5f 55 53 45 52 5c 5c 53 4f 46 54 57 41 52 45 5c 22 20 2f 76 20 5c 22 44 65 63 72 79 70 74 35 30 5c 22 20 2f 74 20 52 45 47 5f 53 5a 20 2f 64 20 31 20 }
        $s13 = { 52 45 47 20 41 44 44 20 5c 22 48 4b 45 59 5f 43 55 52 52 45 4e 54 5f 55 53 45 52 5c 5c 53 4f 46 54 57 41 52 45 5c 22 20 2f 76 20 5c 22 74 65 73 74 64 65 63 72 79 70 74 5c 22 20 2f 74 20 52 45 47 5f 53 5a 20 2f 64 20 31 20 }
        $s14 = { 64 65 63 72 79 70 74 69 6f 6e 20 69 73 20 6c 6f 6e 67 20 70 72 6f 63 65 73 73 }
    condition:
        ( uint16(0) == 0x5a4d and filesize < 400KB and ((6 of them) or (all of them)))
}
